#!/bin/bash

echo "Building \"GIF\" picture $2" 1>&2

export PATH=$PATH:$PWD/bin

if test -d $HOME/tmp ; then
	TMP_DIR=$HOME/tmp
else
	#echo "A ~/tmp directory would be preferable - using /tmp for the moment" 1>&2
	TMP_DIR=/tmp
fi

COLOUR_FILENAME=${TMP_DIR}/`hexdump </dev/urandom | head -n 1 | tr -d " "`
ALPHA_FILENAME=${TMP_DIR}/`hexdump </dev/urandom | head -n 1 | tr -d " "`

pngtopnm $1 >$COLOUR_FILENAME
pngtopnm -alpha $1 >$ALPHA_FILENAME

pnmbg $COLOUR_FILENAME $ALPHA_FILENAME | pnmtopng >$2

rm $COLOUR_FILENAME $ALPHA_FILENAME
